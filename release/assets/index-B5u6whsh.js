var S=Object.defineProperty;var R=(a,e,t)=>e in a?S(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var o=(a,e,t)=>R(a,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const g of l.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&s(g)}).observe(document,{childList:!0,subtree:!0});function t(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(i){if(i.ep)return;i.ep=!0;const l=t(i);fetch(i.href,l)}})();const h=class h{constructor(e=null){o(this,"mt",new Array(h.N));o(this,"mti",h.N+1);e==null&&(e=new Date().getTime()),this.init_genrand(e)}init_genrand(e){for(this.mt[0]=e>>>0,this.mti=1;this.mti<h.N;this.mti++){var e=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(((e&4294901760)>>>16)*1812433253<<16)+(e&65535)*1812433253+this.mti,this.mt[this.mti]>>>=0}}_nextInt32(){var e,t=new Array(0,h.MATRIX_A);if(this.mti>=h.N){var s;for(this.mti==h.N+1&&this.init_genrand(5489),s=0;s<h.N-h.M;s++)e=this.mt[s]&h.UPPER_MASK|this.mt[s+1]&h.LOWER_MASK,this.mt[s]=this.mt[s+h.M]^e>>>1^t[e&1];for(;s<h.N-1;s++)e=this.mt[s]&h.UPPER_MASK|this.mt[s+1]&h.LOWER_MASK,this.mt[s]=this.mt[s+(h.M-h.N)]^e>>>1^t[e&1];e=this.mt[h.N-1]&h.UPPER_MASK|this.mt[0]&h.LOWER_MASK,this.mt[h.N-1]=this.mt[h.M-1]^e>>>1^t[e&1],this.mti=0}return e=this.mt[this.mti++],e^=e>>>11,e^=e<<7&2636928640,e^=e<<15&4022730752,e^=e>>>18,e>>>0}nextInt32(e=null){var t=this._nextInt32();return e==null?t:t%(e[1]-e[0])+e[0]}nextInt31(){return this._nextInt32()>>>1}nextNumber(){return this._nextInt32()*(1/4294967295)}nextNumber53(){var e=this._nextInt32()>>>5,t=this._nextInt32()>>>6;return(e*67108864+t)*(1/9007199254740992)}};o(h,"N",624),o(h,"M",397),o(h,"MATRIX_A",2567483615),o(h,"UPPER_MASK",2147483648),o(h,"LOWER_MASK",2147483647);let E=h;async function $(a){return new Promise((e,t)=>{setTimeout(e,a)})}const M=["①","②","③","④","⑤","⑥","⑦","⑧","⑨"];class v{constructor(e,t){o(this,"board");o(this,"isExplored",!1);o(this,"isKnown",!1);o(this,"triggeredBomb",!1);o(this,"isFlag",0);o(this,"neighborsNamed",{topLeft:null,topRight:null,left:null,right:null,bottomLeft:null,bottomRight:null});o(this,"neighborsArray",[]);o(this,"bombValue",0);o(this,"tileElement");o(this,"hexElement");o(this,"position");if(this.board=e,t!=null&&t.isExplored&&(this.isExplored=t.isExplored),t!=null&&t.neighborsNamed&&(this.neighborsNamed=t.neighborsNamed),t!=null&&t.value&&(this.bombValue=t.value),t!=null&&t.neighborsNamed)for(const s of Object.values(t.neighborsNamed))s!==null&&this.neighborsArray.push(s);if(!(t!=null&&t.position))throw new Error("Position must be defined on Tile");this.position=t.position}triggerBomb(e=!1){this.triggeredBomb||(this.triggeredBomb=!0,this.isFlag!==0&&(this.board.bombs[this.isFlag-1]++,this.board.renderBombDisplay(),this.isFlag=0),this.hexElement.innerText=M[this.bombValue-1],this.hexElement.className="hex bomb",this.board.bombs[this.bombValue-1]--,e||this.board.hits++,this.board.renderBombDisplay())}updateExploredState(){if(!this.isKnown)return;const e=this.neighborsArray.reduce((t,s)=>t+s.bombValue,0);e===0?(this.hexElement.innerText="",this.hexElement.className="hex explored"):(this.hexElement.innerText=e.toString(),this.hexElement.className="hex risky")}clearNeighbors(){if(this.isExplored){this.isExplored=!1;for(const e of this.neighborsArray)e.clearNeighbors()}}async onClick(e){if(this.isExplored)return console.log("Clicked on known node");if(!(e&&this.board.processingEchos>0)){if(this.isFlag!==0&&e){const t=this.isFlag*y.energySplit;if(this.board.energy>=t)if(this.board.energy-=t,this.board.renderEnergyDisplay(),this.bombValue===0)await this.clickRevealNormal(e);else if(this.isFlag>=this.bombValue){this.board.bombs[this.bombValue-1]--,this.bombValue=0,this.board.bombs[this.isFlag-1]++,this.isFlag,this.board.renderBombDisplay(),this.isExplored=!0,this.clearNeighbors();for(const i of this.neighborsArray)i.updateExploredState();const s=this.neighborsArray.reduce((i,l)=>i+l.bombValue,0);if(s===0)await this.onClick();else{this.isKnown=!0,this.hexElement.innerText=s.toString(),this.hexElement.className="hex risky";for(const i of this.neighborsArray)(i.isExplored||i.isKnown||this.neighborsArray.reduce((l,g)=>l+g.bombValue,0)===0)&&(this.board.processingEchos++,i.onEcho())}}else this.isExplored=!0,this.triggerBomb()}else await this.clickRevealNormal(e);this.board.checkWin()}}async clickRevealNormal(e){if(this.bombValue!==0)this.triggerBomb();else{this.isKnown||(this.board.energy++,this.board.renderEnergyDisplay());const t=this.neighborsArray.reduce((s,i)=>s+i.bombValue,0);if(t===0){this.isExplored=!0,this.isKnown=!0;for(const s of this.neighborsArray)!s.isExplored&&!s.isKnown&&(this.board.processingEchos++,s.onEcho());this.hexElement.innerText="",this.hexElement.className="hex explored"}else this.isKnown=!0,this.hexElement.innerText=t.toString(),this.hexElement.className="hex risky"}}onContext(e){e==null||e.preventDefault(),!(e&&this.board.processingEchos>0)&&(this.isKnown||this.isExplored||this.triggeredBomb||(this.isFlag=this.isFlag===this.board.bombs.length?0:this.isFlag+1,this.isFlag===0?this.board.bombs[this.board.bombs.length-1]++:this.isFlag===1?this.board.bombs[0]--:(this.board.bombs[this.isFlag-2]++,this.board.bombs[this.isFlag-1]--),this.board.renderBombDisplay(),this.hexElement.innerText=this.isFlag===0?"":`${this.isFlag} 🏁`))}async onEcho(){await $(50),this.isKnown=!0;const e=this.neighborsArray.reduce((t,s)=>t+s.bombValue,0);e===0?await this.onClick():(this.board.energy++,this.board.renderEnergyDisplay(),this.hexElement.innerText=e.toString(),this.hexElement.className="hex risky"),this.board.processingEchos--}paintNeighbors(){this.neighborsArray.forEach(e=>{e.tileElement&&(e.tileElement.style.background="red")})}tagNeighbors(){var e,t,s,i,l,g;(e=this.neighborsNamed.bottomLeft)!=null&&e.tileElement&&(this.neighborsNamed.bottomLeft.tileElement.innerText="BL"),(t=this.neighborsNamed.bottomRight)!=null&&t.tileElement&&(this.neighborsNamed.bottomRight.tileElement.innerText="BR"),(s=this.neighborsNamed.left)!=null&&s.tileElement&&(this.neighborsNamed.left.tileElement.innerText="L"),(i=this.neighborsNamed.right)!=null&&i.tileElement&&(this.neighborsNamed.right.tileElement.innerText="R"),(l=this.neighborsNamed.topLeft)!=null&&l.tileElement&&(this.neighborsNamed.topLeft.tileElement.innerText="TL"),(g=this.neighborsNamed.topRight)!=null&&g.tileElement&&(this.neighborsNamed.topRight.tileElement.innerText="TR")}spawnNode(e){this.tileElement=document.createElement("div"),this.tileElement.addEventListener("click",t=>this.onClick(t)),this.tileElement.addEventListener("contextmenu",t=>this.onContext(t)),this.hexElement=document.createElement("div"),this.hexElement.className="hex unknown",this.tileElement.appendChild(this.hexElement),this.tileElement.classList.add("tile"),this.tileElement.style.top=p+N*this.position.y+"px",this.tileElement.style.left=p+A*(this.position.y%2)+w*this.position.x+"px",e.appendChild(this.tileElement)}}const N=47,w=54,A=26,p=0;function f(a){return`${a<10?"0":""}${a}`}function K(a){const e=Math.floor(a/3600),t=Math.floor(a%3600/60),s=a%60;return t+e===0?`0:${f(s)}`:e===0?`${t}:${f(s)}`:`${e}:${f(t)}:${f(s)}`}function u(a){return a<0?"red":a===0?"#3aecf4":a<6?"lime":a<16?"yellow":"white"}function F(a){switch(a){case 0:return"rgb(255, 255, 255)";case 1:return"rgb(214, 227, 245)";case 2:return"rgb(179, 213, 245)";case 3:return"rgb(135, 195, 243)";case 4:return"rgb(58, 148, 221)";case 5:return"rgb(63, 111, 184)";case 6:return"rgb(63, 75, 184)";case 7:return"rgb(85, 63, 184)";case 8:return"rgb(130, 63, 184)";case 9:return"rgb(169, 80, 221)";case 10:return"rgb(221, 80, 214)";case 11:return"rgb(230, 63, 207)";case 12:return"rgb(228, 44, 151)";case 13:return"rgb(247, 27, 119)";case 14:return"rgb(243, 10, 69)";default:return"rgb(255, 136, 0)"}}const d=class d{constructor(){o(this,"processingEchos",0);o(this,"energy",0);o(this,"tiles",[]);o(this,"bombs",[0,0,0,0,0]);o(this,"hits",0);o(this,"seed",0);o(this,"bombElement");o(this,"energyElement");o(this,"startTime",0);o(this,"won",!1)}renderEnergyDisplay(){const e=this.energy%d.energySplit,t=new Array(e).fill("█"),s=Math.floor(this.energy/d.energySplit);t.push(...new Array(d.energySplit-e).fill("░")),this.energyElement.innerHTML=`<p>
<span class='group'>
  <span class='header'>Energy: <b style='font-weight: 700;'>${s}</b> </span>
  <span class='value' style="color: ${F(s)}">
    [${t.join("")}]
  </span>
</span>
</p>`}renderBombDisplay(){this.bombElement.innerHTML=`<p>
    <span class='group' style="font-size: 14px;">
      <span>
        ${this.seed.toString()}
      </span>
    </span>
<span class='group'>
  <span class='header'>1</span>
  <span class='value' style="color: ${u(this.bombs[0])}">
    ${this.bombs[0]}
  </span>
</span>
<span class='group'>
  <span class='header'>2</span>
  <span class='value' style="color: ${u(this.bombs[1])}">
    ${this.bombs[1]}
  </span>
</span>
<span class='group'>
  <span class='header'>3</span>
  <span class='value' style="color: ${u(this.bombs[2])}">
    ${this.bombs[2]}
  </span>
</span>
<span class='group'>
  <span class='header'>4</span>
  <span class='value' style="color: ${u(this.bombs[3])}">
    ${this.bombs[3]}
  </span>
</span>
<span class='group'>
  <span class='header'>5</span>
  <span class='value' style="color: ${u(this.bombs[4])}">
    ${this.bombs[4]}
  </span>
</span>
<span class='group'>
  <span class='header'>Hits</span>
  <span class='value' style="color: ${u(16-this.hits)}">
    ${this.hits}
  </span>
</span>
</p>`}checkWin(){if(this.won)return;let e=this.tiles.length*this.tiles[0].length;for(let t=0;t<this.tiles.length;t++)for(let s=0;s<this.tiles[t].length;s++){const i=this.tiles[t][s];(i.isExplored||i.isKnown||i.bombValue>0)&&e--}if(e===0){this.won=!0;let t=0;for(let s=0;s<this.tiles.length;s++)for(let i=0;i<this.tiles[s].length;i++){const l=this.tiles[s][i];l.bombValue>0&&(l.triggeredBomb?t++:l.triggerBomb(!0))}this.bombElement.innerHTML+=`<p>You Won${t===0?"! Perfect Score!":`? (${t} exploded)`} | Time: ${K(Math.floor((Date.now()-this.startTime)/1e3))}</p>`}}placeBoard(e,t,s,i,l,g){this.processingEchos=0,this.won=!1,this.startTime=Date.now(),i.innerHTML="",this.bombElement=l,g.innerHTML="",this.energyElement=g,i.style.width=p*3+A+w*e+"px",i.style.height=p*4+N*t+"px",this.tiles=[],this.bombs=[0,0,0,0,0],this.hits=0;const L=s<0;this.seed=Number.isNaN(s)?new Date().getTime():Math.abs(s);const T=new E(this.seed);for(let b=0;b<e;b++){let m=[];for(let r=0;r<t;r++){let n=T.nextNumber();n<.8?n=0:n<.9?this.bombs[(n=1)-1]++:n<.95?this.bombs[(n=2)-1]++:n<.975?this.bombs[(n=3)-1]++:n<.99?this.bombs[(n=4)-1]++:this.bombs[(n=5)-1]++;const c=new v(this,{position:{x:b,y:r},value:n});c.spawnNode(i),L&&(c.hexElement.innerText=n>0?"?":""),m.push(c)}this.tiles.push(m)}for(let b=0;b<e;b++)for(let m=0;m<t;m++){const r=this.tiles[b][m];if(r.position.y>0)if(r.position.y%2===1){const n=this.tiles[b][m-1];if(r.neighborsNamed.topLeft=n,r.neighborsArray.push(n),r.position.x<e-1){const c=this.tiles[b+1][m-1];r.neighborsNamed.topRight=c,r.neighborsArray.push(c)}}else{const n=this.tiles[b][m-1];if(r.neighborsNamed.topRight=n,r.neighborsArray.push(n),r.position.x>0){const c=this.tiles[b-1][m-1];r.neighborsNamed.topLeft=c,r.neighborsArray.push(c)}}if(r.position.x>0){const n=this.tiles[b-1][m];r.neighborsNamed.left=n,r.neighborsArray.push(n)}if(r.position.x<e-1){const n=this.tiles[b+1][m];r.neighborsNamed.right=n,r.neighborsArray.push(n)}if(r.position.y<t-1)if(r.position.y%2===1){const n=this.tiles[b][m+1];if(r.neighborsNamed.bottomLeft=n,r.neighborsArray.push(n),r.position.x<e-1){const c=this.tiles[b+1][m+1];r.neighborsNamed.bottomRight=c,r.neighborsArray.push(c)}}else{const n=this.tiles[b][m+1];if(r.neighborsNamed.bottomRight=n,r.neighborsArray.push(n),r.position.x>0){const c=this.tiles[b-1][m+1];r.neighborsNamed.bottomLeft=c,r.neighborsArray.push(c)}}r.neighborsNamed}this.renderBombDisplay(),this.renderEnergyDisplay()}};o(d,"energySplit",25);let y=d;const x=document.querySelector("#new-game");x&&x.addEventListener("click",()=>{const a=new y,e=document.querySelector("#board"),t=document.querySelector("#seed"),s=document.querySelector("#board-size-w"),i=document.querySelector("#board-size-h"),l=document.querySelector("#board-bombs"),g=document.querySelector("#board-energy");t&&e&&s&&i&&l&&g?a.placeBoard(parseInt(s.value),parseInt(i.value),parseInt(t.value),e,l,g):alert("Game failed to start! (DOM Element or Input is null)")});
